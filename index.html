<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Shima Galerie - Realistische Kunstwerke mit Kugelschreiber und Bleistift" />
  <title>Shima Galerie | Realistische Kunst</title>
  <!-- Open Graph / Twitter Cards -->
  <meta property="og:title" content="Shima Galerie – Realistische Kunst" />
  <meta property="og:description" content="Kugelschreiber- & Bleistiftkunst von Shima. Galerie & Kontakt." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://miladnd01.github.io/shima-galerie/" />
  <meta property="og:image" content="https://miladnd01.github.io/shima-galerie/cover.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Shima Galerie – Realistische Kunst" />
  <meta name="twitter:description" content="Kugelschreiber- & Bleistiftkunst von Shima. Galerie & Kontakt." />
  <meta name="twitter:image" content="https://miladnd01.github.io/shima-galerie/cover.jpg" />
  <meta name="theme-color" content="#1a1a1a" />
  <link rel="icon" href="/favicon.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --primary-dark: #1a1a1a;
      --secondary-dark: #2d2d2d;
      --accent: #d4af37;
      --text-light: #f5f5f5;
      --text-dark: #333;
      --bg-light: #fafafa;
      --shadow: rgba(0, 0, 0, 0.15);
    }

    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: var(--text-dark); background: var(--bg-light); }

    .language-selector { position: fixed; top: 20px; right: 20px; z-index: 1000; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px var(--shadow); overflow: hidden; }
    .language-selector select { padding: 0.7rem 1.5rem; font-size: 1rem; border: none; background: #fff; color: var(--primary-dark); cursor: pointer; font-weight: 500; }
    .language-selector select:focus { outline: 2px solid var(--accent); }

    header { background: linear-gradient(135deg, var(--primary-dark) 0%, var(--secondary-dark) 100%); color: var(--text-light); padding: 4rem 2rem; text-align: center; position: relative; overflow: hidden; }
    header::before { content: ''; position: absolute; inset: 0; background: radial-gradient(circle at 30% 50%, rgba(212,175,55,0.1) 0%, transparent 50%); pointer-events: none; }
    header h1 { font-size: 3.5rem; font-weight: 700; margin-bottom: 0.5rem; letter-spacing: 2px; position: relative; z-index: 1; }
    header p { font-size: 1.3rem; color: rgba(255,255,255,0.85); position: relative; z-index: 1; }

    nav { background: var(--secondary-dark); padding: 1rem; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px var(--shadow); }
    nav ul { list-style: none; display: flex; justify-content: center; gap: 3rem; flex-wrap: wrap; }
    nav a { color: var(--text-light); text-decoration: none; font-size: 1.1rem; font-weight: 500; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s ease; position: relative; }
    nav a::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 2px; background: var(--accent); transition: all 0.3s ease; transform: translateX(-50%); }
    nav a:hover { color: var(--accent); }
    nav a:hover::after { width: 80%; }

    section { max-width: 1200px; margin: 3rem auto; padding: 2rem; }

    h2 { font-size: 2.5rem; margin-bottom: 2rem; color: var(--primary-dark); text-align: center; position: relative; padding-bottom: 1rem; }
    h2::after { content: ''; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 80px; height: 3px; background: var(--accent); }

    .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 3rem; }
    .gallery-item { position: relative; overflow: hidden; border-radius: 16px; box-shadow: 0 6px 18px var(--shadow); transition: transform 0.3s ease, box-shadow 0.3s ease; background: #fff; cursor: zoom-in; border: 1px solid rgba(0,0,0,0.06); aspect-ratio: 4 / 5; }
    .gallery-item::before { content: ""; position: absolute; inset: 0; pointer-events: none; border-radius: 16px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.6), inset 0 0 0 2px rgba(0,0,0,0.04); }
    .gallery-item:hover { transform: translateY(-10px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; object-position: center; display: block; transition: transform 0.5s ease; }
    .gallery-item:hover img { transform: scale(1.1); }
    .gallery-overlay { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.55); color: #fff; padding: 0.45rem 0.85rem; border-radius: 999px; font-weight: 600; font-size: 0.95rem; backdrop-filter: blur(4px); border: 1px solid rgba(255,255,255,0.25); pointer-events: none; }

    .about-container { background: #fff; padding: 3rem; border-radius: 12px; box-shadow: 0 4px 15px var(--shadow); max-width: 700px; margin: 2rem auto; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .about-container:hover { transform: translateY(-10px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }

    .purchase-info { background: #fff; padding: 2.5rem; border-radius: 12px; box-shadow: 0 4px 15px var(--shadow); max-width: 800px; margin: 3rem auto; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .purchase-info:hover { transform: translateY(-10px); box-shadow: 0 8px 25px rgba(0,0,0,0.2); }
    .purchase-info p { font-size: 1.15rem; line-height: 1.8; color: var(--text-dark); text-align: center; margin: 0; }
    .purchase-info strong { color: var(--accent); font-weight: 700; }

    footer { background: var(--primary-dark); color: var(--text-light); text-align: center; padding: 2rem; margin-top: 4rem; }
    footer p { margin: 0; font-size: 0.95rem; }

    /* ===== Fullscreen Lightbox ===== */
    .lightbox { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.92); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 1rem; touch-action: none; }
    .lightbox.open { display: flex; }
    /* Stage wrapper for pan/zoom */
    #lbStage { position: relative; max-width: 92vw; max-height: 92vh; display: flex; align-items: center; justify-content: center; transform: translate3d(0,0,0) scale(1); will-change: transform; cursor: grab; touch-action: none; }
    #lbStage:active { cursor: grabbing; }
    #lbImg { max-width: 100%; max-height: 100%; width: auto; height: auto; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); user-select: none; -webkit-user-drag: none; }
    .lightbox .close-btn { position: absolute; top: 18px; right: 18px; background: transparent; border: 2px solid rgba(255,255,255,0.6); color: #fff; font-size: 1rem; padding: 0.35rem 0.75rem; border-radius: 999px; cursor: pointer; transition: 0.2s ease; }
    .lightbox .close-btn:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
    .lightbox .counter { position: absolute; bottom: 18px; left: 50%; transform: translateX(-50%); color: rgba(255,255,255,0.85); font-size: 0.95rem; }
    .lightbox .nav { position: absolute; inset: 0; display: flex; align-items: center; justify-content: space-between; pointer-events: none; }
    .lightbox .nav button { pointer-events: auto; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: #fff; font-size: 1.25rem; padding: 0.6rem 0.9rem; margin: 0 0.75rem; border-radius: 10px; cursor: pointer; transition: 0.2s ease; backdrop-filter: blur(2px); }
    .lightbox .nav button:hover { background: rgba(255,255,255,0.2); border-color: #fff; }
    body.lb-lock { overflow: hidden; }

    @media (max-width: 768px) {
      .language-selector { top: 10px; right: 10px; }
      header { padding: 3rem 1.25rem; }
      header h1 { font-size: 2.25rem; }
      header p { font-size: 1rem; }
      h2 { font-size: 1.75rem; }

      nav ul { gap: 1rem; overflow-x: auto; padding-bottom: 0.25rem; -webkit-overflow-scrolling: touch; }
      nav ul::-webkit-scrollbar { display: none; }

      .gallery { grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 1rem; }
      .gallery-item { aspect-ratio: 3 / 4; }
      .about-container { padding: 1.25rem; }
      section { padding: 1rem; }

      /* Lightbox controls bigger for touch */
      .lightbox .nav button { font-size: 1.35rem; padding: 0.8rem 1rem; margin: 0 0.5rem; }
      .lightbox .close-btn { font-size: 1.1rem; padding: 0.5rem 0.9rem; top: 16px; right: 16px; }
      .lightbox .counter { font-size: 1.05rem; bottom: 16px; }
    }

    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; animation: none !important; }
    }
  </style>
</head>
<body>
  <div class="language-selector">
    <select id="languageSelect" onchange="changeLanguage()">
      <option value="de">Deutsch</option>
      <option value="en">English</option>
      <option value="fa">فارسی</option>
    </select>
  </div>

  <header>
    <h1>Shima Galerie</h1>
    <p id="headerSubtitle">Realistische Kunstwerke mit Kugelschreiber & Bleistift ✏️</p>
  </header>

  <nav>
    <ul>
      <li><a href="#ueber" id="navAbout">Über mich</a></li>
      <li><a href="#galerie" id="navGallery">Galerie</a></li>
      <li><a href="#kontakt" id="navContact">Kontakt</a></li>
    </ul>
  </nav>

  <section id="ueber">
    <h2 id="aboutTitle">Über mich</h2>
    <div class="about-container">
      <p id="aboutText" style="text-align: center; line-height: 1.8;">
        Willkommen in meiner Galerie! Ich bin Shima und erschaffe realistische Kunstwerke 
        mit Kugelschreiber und Bleistift. Jedes Werk entsteht durch Geduld, Präzision 
        und Leidenschaft für Details. Meine Inspiration finde ich in der Schönheit 
        des Alltäglichen und der Komplexität menschlicher Ausdrucksformen.
      </p>
    </div>
  </section>

  <section id="galerie">
    <h2 id="galleryTitle">Meine Kunstwerke</h2>
    <div class="gallery" id="galleryGrid">
        <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0471.JPG" alt="Kunstwerk 1"><div class="gallery-overlay"><span>#001</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0472.JPG" alt="Kunstwerk 1"><div class="gallery-overlay"><span>#001</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0474.JPG" alt="Kunstwerk 2"><div class="gallery-overlay"><span>#002</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0476.JPG" alt="Kunstwerk 3"><div class="gallery-overlay"><span>#003</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0477.JPG" alt="Kunstwerk 4"><div class="gallery-overlay"><span>#004</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0479.JPG" alt="Kunstwerk 5"><div class="gallery-overlay"><span>#005</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0481.JPG" alt="Kunstwerk 6"><div class="gallery-overlay"><span>#006</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0482.JPG" alt="Kunstwerk 7"><div class="gallery-overlay"><span>#007</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0485.JPG" alt="Kunstwerk 8"><div class="gallery-overlay"><span>#008</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="IMG_0486.JPG" alt="Kunstwerk 9"><div class="gallery-overlay"><span>#009</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-09-19_01-14-34.jpg" alt="Kunstwerk 10"><div class="gallery-overlay"><span>#010</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-04-36.jpg" alt="Kunstwerk 11"><div class="gallery-overlay"><span>#011</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-04-44.jpg" alt="Kunstwerk 12"><div class="gallery-overlay"><span>#00</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-04-51.jpg" alt="Kunstwerk 13"><div class="gallery-overlay"><span>#00</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-05-39.jpg" alt="Kunstwerk 14"><div class="gallery-overlay"><span>#014</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-08.jpg" alt="Kunstwerk 15"><div class="gallery-overlay"><span>#015</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-16.jpg" alt="Kunstwerk 16"><div class="gallery-overlay"><span>#00</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-24.jpg" alt="Kunstwerk 17"><div class="gallery-overlay"><span>#00</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-31.jpg" alt="Kunstwerk 18"><div class="gallery-overlay"><span>#018</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-39.jpg" alt="Kunstwerk 19"><div class="gallery-overlay"><span>#019</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-06-52.jpg" alt="Kunstwerk 20"><div class="gallery-overlay"><span>#020</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-07-09.jpg" alt="Kunstwerk 21"><div class="gallery-overlay"><span>#021</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-07-39.jpg" alt="Kunstwerk 22"><div class="gallery-overlay"><span>#022</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-07-54.jpg" alt="Kunstwerk 23"><div class="gallery-overlay"><span>#023</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-08-09.jpg" alt="Kunstwerk 24"><div class="gallery-overlay"><span>#024</span></div></div>
      <div class="gallery-item"><img loading="lazy" decoding="async" src="photo_2025-10-02_19-08-16.jpg" alt="Kunstwerk 25"><div class="gallery-overlay"><span>#025</span></div></div>
    </div>

    <div class="purchase-info">
      <p id="purchaseInfo">
        <strong>Interessiert an einem Kunstwerk?</strong><br />
        Für Verkauf, Ausstellungen, Entwürfe oder Zusammenarbeit kontaktieren Sie mich bitte unter: <strong>ShimaArtist1994@gmail.com</strong>
      </p>
    </div>
  </section>

  <section id="kontakt"></section>

  <footer>
    <p id="footerText">Erstellt von Bikineh</p>
  </footer>

  <!-- ===== Fullscreen Lightbox Markup ===== -->
  <div class="lightbox" id="lightbox" aria-hidden="true" role="dialog" aria-label="Bild Großansicht">
    <button class="close-btn" id="lbClose" aria-label="Schließen (Esc)">✕</button>
    <div class="nav">
      <button id="lbPrev" aria-label="Vorheriges (←)">←</button>
      <button id="lbNext" aria-label="Nächstes (→)">→</button>
    </div>
    <div id="lbStage"><img id="lbImg" src="" alt="Großes Bild" /></div>
    <div class="counter" id="lbCounter">1 / 1</div>
  </div>

  <script>
    const translations = {
      de: {
        headerSubtitle: 'Realistische Kunstwerke mit Kugelschreiber & Bleistift ✏️',
        navAbout: 'Über mich',
        navGallery: 'Galerie',
        navContact: 'Kontakt',
        aboutTitle: 'Über mich',
        aboutText: 'Willkommen in meiner Galerie! Ich bin Shima und erschaffe realistische Kunstwerke mit Kugelschreiber und Bleistift. Jedes Werk entsteht durch Geduld, Präzision und Leidenschaft für Details. Meine Inspiration finde ich in der Schönheit des Alltäglichen und der Komplexität menschlicher Ausdrucksformen.',
        galleryTitle: 'Meine Kunstwerke',
        purchaseInfo: '<strong>Interessiert an einem Kunstwerk?</strong><br>Für Verkauf, Ausstellungen, Entwürfe oder Zusammenarbeit kontaktieren Sie mich bitte unter: <strong>ShimaArtist1994@gmail.com</strong>',
        footerText: 'Erstellt von Bikineh'
      },
      en: {
        headerSubtitle: 'Realistic Artwork with Pen & Pencil ✏️',
        navAbout: 'About Me',
        navGallery: 'Gallery',
        navContact: 'Contact',
        aboutTitle: 'About Me',
        aboutText: 'Welcome to my gallery! I am Shima and I create realistic artworks with pen and pencil. Each piece is created with patience, precision and passion for detail. I find my inspiration in the beauty of everyday life and the complexity of human expression.',
        galleryTitle: 'My Artworks',
        purchaseInfo: '<strong>Interested in an artwork?</strong><br>For purchase, exhibitions, commissions or collaborations, please contact me at: <strong>ShimaArtist1994@gmail.com</strong>',
        footerText: 'Created by Bikineh'
      },
      fa: {
        headerSubtitle: 'آثار هنری واقع‌گرایانه با خودکار و مداد ✏️',
        navAbout: 'درباره من',
        navGallery: 'گالری',
        navContact: 'تماس',
        aboutTitle: 'درباره من',
        aboutText: 'به گالری من خوش آمدید! من شیما هستم و آثار هنری واقع‌گرایانه با خودکار و مداد خلق می‌کنم. هر اثر با صبر، دقت و اشتیاق به جزئیات ایجاد می‌شود. الهام من را در زیبایی زندگی روزمره و پیچیدگی بیان انسانی می‌یابم.',
        galleryTitle: 'آثار هنری من',
        purchaseInfo: '<strong>به یک اثر هنری علاقه‌مند هستید؟</strong><br>برای خرید، نمایشگاه‌ها، سفارشات یا همکاری، لطفاً با من تماس بگیرید: <strong>ShimaArtist1994@gmail.com</strong>',
        footerText: 'ساخته شده توسط بی کینه'
      }
    };

    function changeLanguage() {
      const lang = document.getElementById('languageSelect').value;
      const t = translations[lang];

      document.getElementById('headerSubtitle').textContent = t.headerSubtitle;
      document.getElementById('navAbout').textContent = t.navAbout;
      document.getElementById('navGallery').textContent = t.navGallery;
      document.getElementById('navContact').textContent = t.navContact;
      document.getElementById('aboutTitle').textContent = t.aboutTitle;
      document.getElementById('aboutText').textContent = t.aboutText;
      document.getElementById('galleryTitle').textContent = t.galleryTitle;
      document.getElementById('purchaseInfo').innerHTML = t.purchaseInfo;
      document.getElementById('footerText').textContent = t.footerText;

      if (lang === 'fa') {
        document.body.style.direction = 'rtl';
      } else {
        document.body.style.direction = 'ltr';
      }
    }

    // Smooth scroll for nav links
    document.querySelectorAll('nav a').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });

    // ===== Lightbox Logic =====
    (function setupLightbox() {
      const lb = document.getElementById('lightbox');
      const lbStage = document.getElementById('lbStage');
      const lbImg = document.getElementById('lbImg');
      const lbClose = document.getElementById('lbClose');
      const lbPrev = document.getElementById('lbPrev');
      const lbNext = document.getElementById('lbNext');
      const lbCounter = document.getElementById('lbCounter');

      const grid = document.getElementById('galleryGrid');
      const items = Array.from(grid.querySelectorAll('.gallery-item img'));
      const cards = Array.from(grid.querySelectorAll('.gallery-item'));

      // Lightbox state variables
      let currentIndex = 0;
      let scale = 1;
      let tx = 0;
      let ty = 0;
      const minScale = 1;
      const maxScale = 5;
      const pointers = new Map();
      let baseDist = 1;
      let baseScale = 1;

      // Event Delegation: Klick überall auf der Karte (auch Overlay) öffnet die Lightbox
      grid.addEventListener('click', (e) => {
        const card = e.target.closest('.gallery-item');
        if (!card) return;
        const i = cards.indexOf(card);
        if (i > -1) openAt(i);
      });

      // Keyboard-Access: Enter auf fokussierter Karte öffnet Lightbox
      cards.forEach((card, i) => {
        card.setAttribute('tabindex', '0');
        card.setAttribute('role', 'button');
        card.setAttribute('aria-label', 'Großansicht öffnen');
        card.addEventListener('keydown', (e) => { if (e.key === 'Enter') openAt(i); });
      });

      lbClose.addEventListener('click', close);
      lbNext.addEventListener('click', () => { resetTransform(); next(); });
      lbPrev.addEventListener('click', () => { resetTransform(); prev(); });

      // Close on backdrop click (ignore clicks on stage, image or buttons)
      lb.addEventListener('click', (e) => {
        const controls = [lbStage, lbImg, lbNext, lbPrev, lbClose];
        if (!controls.includes(e.target) && !controls.some(el => el.contains(e.target))) close();
      });

      // Keyboard support
      document.addEventListener('keydown', (e) => {
        if (!lb.classList.contains('open')) return;
        if (e.key === 'Escape') close();
        if (e.key === 'ArrowRight') { resetTransform(); next(); }
        if (e.key === 'ArrowLeft') { resetTransform(); prev(); }
      });

      // Helpers
      const distance = (p1, p2) => Math.hypot(p2.clientX - p1.clientX, p2.clientY - p1.clientY);
      const clamp = (v, min, max) => Math.min(max, Math.max(min, v));

      // Pointer events for pan & pinch-zoom
      lbStage.addEventListener('pointerdown', (e) => {
        try { lbStage.setPointerCapture(e.pointerId); } catch (_) {}
        pointers.set(e.pointerId, e);
        if (pointers.size === 2) {
          const [a, b] = Array.from(pointers.values());
          baseDist = distance(a, b) || 1; // avoid 0
          baseScale = scale;
        }
      });

      lbStage.addEventListener('pointermove', (e) => {
        if (!pointers.has(e.pointerId)) return;
        const prevEvt = pointers.get(e.pointerId);
        pointers.set(e.pointerId, e);

        if (pointers.size === 2) {
          const [a, b] = Array.from(pointers.values());
          const newDistRaw = distance(a, b);
          const safeBase = baseDist || 1; // avoid division by 0
          const newScale = clamp((newDistRaw / safeBase) * baseScale, minScale, maxScale);

          // Zoom around the midpoint
          const midX = (a.clientX + b.clientX) / 2; const midY = (a.clientY + b.clientY) / 2;
          const dx = midX - window.innerWidth / 2; const dy = midY - window.innerHeight / 2;
          const scaleDelta = newScale - scale;
          tx -= dx * scaleDelta / Math.max(newScale, 0.0001);
          ty -= dy * scaleDelta / Math.max(newScale, 0.0001);
          scale = newScale; applyTransform();
        } else if (pointers.size === 1 && scale > 1 && prevEvt) {
          // Pan when zoomed
          const dx = e.clientX - prevEvt.clientX; const dy = e.clientY - prevEvt.clientY;
          tx += dx; ty += dy; applyTransform();
        }
      });

      function handlePointerEnd(e) {
        pointers.delete(e.pointerId);
        if (pointers.size === 1) {
          // Reset pinch baseline when a finger lifts
          baseScale = scale; baseDist = 1;
        }
      }
      lbStage.addEventListener('pointerup', handlePointerEnd);
      lbStage.addEventListener('pointercancel', handlePointerEnd);

      // Double click / double tap to toggle zoom
      let lastTap = 0;
      lbStage.addEventListener('click', (e) => {
        const now = Date.now();
        if (now - lastTap < 300) {
          const targetScale = scale > 1 ? 1 : 2;
          const rect = lbStage.getBoundingClientRect();
          const cx = e.clientX - (rect.left + rect.width / 2);
          const cy = e.clientY - (rect.top + rect.height / 2);
          tx -= cx * (targetScale - scale) / targetScale;
          ty -= cy * (targetScale - scale) / targetScale;
          scale = targetScale; applyTransform();
        }
        lastTap = now;
      });

      // Wheel zoom (desktop)
      lb.addEventListener('wheel', (e) => {
        if (!lb.classList.contains('open')) return;
        e.preventDefault();
        const delta = Math.sign(e.deltaY);
        const targetScale = clamp(scale + (delta < 0 ? 0.15 : -0.15), minScale, maxScale);
        const rect = lbStage.getBoundingClientRect();
        const cx = e.clientX - (rect.left + rect.width / 2);
        const cy = e.clientY - (rect.top + rect.height / 2);
        tx -= cx * (targetScale - scale) / targetScale;
        ty -= cy * (targetScale - scale) / targetScale;
        scale = targetScale; applyTransform();
      }, { passive: false });

      // Lightbox functions
      function openAt(index) {
        currentIndex = index;
        updateImage();
        lb.classList.add('open');
        document.body.classList.add('lb-lock');
        resetTransform();
      }

      function close() {
        lb.classList.remove('open');
        document.body.classList.remove('lb-lock');
        resetTransform();
      }

      function next() {
        currentIndex = (currentIndex + 1) % items.length;
        updateImage();
      }

      function prev() {
        currentIndex = (currentIndex - 1 + items.length) % items.length;
        updateImage();
      }

      function updateImage() {
        lbImg.src = items[currentIndex].src;
        lbImg.alt = items[currentIndex].alt;
        lbCounter.textContent = `${currentIndex + 1} / ${items.length}`;
      }

      function resetTransform() {
        scale = 1;
        tx = 0;
        ty = 0;
        applyTransform();
      }

      function applyTransform() {
        lbStage.style.transform = `translate3d(${tx}px, ${ty}px, 0) scale(${scale})`;
      }
    })();
  </script>
</body>
</html>
